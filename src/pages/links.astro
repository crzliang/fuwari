---
import MainGridLayout from "../layouts/MainGridLayout.astro";
import FriendCard, { type FriendLink } from "../components/widget/FriendCard.astro";
import { linksConfig } from "../config";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import linksData from "../../public/links.json";

interface FriendGroup {
	name: string;
	description: string;
	links: FriendLink[];
}

const friendGroups: FriendGroup[] = linksData.friends || [];

// 随机打乱数组的函数
function shuffle<T>(array: T[]): T[] {
	const arr = [...array];
	for (let i = arr.length - 1; i > 0; i--) {
		const j = Math.floor(Math.random() * (i + 1));
		[arr[i], arr[j]] = [arr[j], arr[i]];
	}
	return arr;
}

const applyTip = linksConfig.applyTip;
---

<MainGridLayout title={i18n(I18nKey.links)} description={i18n(I18nKey.links)}>
	<div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative">
		<div class="card-base z-10 px-6 md:px-9 py-6 relative w-full">
			<h1 class="text-3xl font-bold mb-6">{i18n(I18nKey.links)}</h1>

			<p class="mb-6 text-black/75 dark:text-white/75">
				{i18n(I18nKey.linksDesc)}
			</p>

			{friendGroups.map((group) => (
				<div class="mb-8">
					<h2 class="text-2xl font-bold mb-4" id={group.name.toLowerCase().replace(/\s+/g, '-')}>
						{group.name}
					</h2>

					{group.links.length > 0 ? (
						<div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
							{shuffle(group.links).map((friend) => (
								<FriendCard friend={friend} />
							))}
						</div>
					) : (
						<p class="text-black/50 dark:text-white/50 italic">
							{i18n(I18nKey.noLinks)}
						</p>
					)}
				</div>
			))}

			<div class="mt-10">
				<h2 class="text-2xl font-bold mb-4" id="apply">
					{i18n(I18nKey.applyLinks)}
				</h2>

				<p class="mb-4 text-black/75 dark:text-white/75">
					{i18n(I18nKey.siteInfo)}
				</p>

				<blockquote class="not-prose border-l-4 border-[var(--primary)] pl-4 py-2 mb-6 bg-[var(--btn-regular-bg)] rounded-r-lg">
					<div class="grid grid-cols-[auto_1fr] gap-x-4 gap-y-2">
						<span class="text-right font-semibold">{i18n(I18nKey.siteName)}:</span>
						<code class="cursor-pointer hover:text-[var(--primary)] transition"
							onclick={`navigator.clipboard.writeText('${applyTip.name}'); alert('已复制到剪贴板 Copied!')`}>
							{applyTip.name}
						</code>

						<span class="text-right font-semibold">{i18n(I18nKey.siteIntro)}:</span>
						<code class="cursor-pointer hover:text-[var(--primary)] transition break-all"
							onclick={`navigator.clipboard.writeText('${applyTip.intro}'); alert('已复制到剪贴板 Copied!')`}>
							{applyTip.intro}
						</code>

						<span class="text-right font-semibold">{i18n(I18nKey.siteLink)}:</span>
						<code class="cursor-pointer hover:text-[var(--primary)] transition break-all"
							onclick={`navigator.clipboard.writeText('${applyTip.link}'); alert('已复制到剪贴板 Copied!')`}>
							{applyTip.link}
						</code>

						<span class="text-right font-semibold">{i18n(I18nKey.siteAvatar)}:</span>
						<code class="cursor-pointer hover:text-[var(--primary)] transition break-all"
							onclick={`navigator.clipboard.writeText('${applyTip.avatar}'); alert('已复制到剪贴板 Copied!')`}>
							{applyTip.avatar}
						</code>
					</div>
				</blockquote>

				<p class="mb-4 text-black/75 dark:text-white/75">
					{i18n(I18nKey.applyDesc)}
				</p>

				<ul class="list-disc list-inside space-y-2 text-black/75 dark:text-white/75 ml-4">
					<li>{i18n(I18nKey.applyRule1)}</li>
					<li>{i18n(I18nKey.applyRule2)}</li>
					<li>{i18n(I18nKey.applyRule3)}</li>
					<li>{i18n(I18nKey.applyRule4)}</li>
				</ul>
			</div>
		</div>
	</div>
</MainGridLayout>
